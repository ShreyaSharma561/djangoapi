{% extends 'base.html' %}

{% block title %}Create Blog - BlogApp{% endblock %}

{% block style %}
    .container {
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-group label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
    }
    #title {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    #content {
        width: 100%;
        height: 300px;
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: vertical;
    }
    #category, #status {
        width: 100%;
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    #featured_image {
        width: 100%;
        padding: 10px;
    }
    button {
        background-color: #007bff;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
    }
    button:hover {
        background-color: #0056b3;
    }
    .image-preview {
        max-width: 300px;
        margin-top: 10px;
        display: none;
    }
    .image-preview img {
        width: 100%;
        border-radius: 4px;
        border: 1px solid #ddd;
    }
{% endblock %}

{% block content %}
<div class="container">
    <h2>Create New Blog Post</h2>
    
    <div class="form-group">
        <label for="title">Title</label>
        <input id="title" type="text" placeholder="Enter blog title">
    </div>

    <div class="form-group">
        <label for="content">Content</label>
        <textarea id="content" placeholder="Write your blog content here..."></textarea>
    </div>

    <div class="form-group">
        <label for="category">Category</label>
        <select id="category">
            <option value="">Select a category</option>
            <option value="tech">Tech</option>
            <option value="lifestyle">Lifestyle</option>
            <option value="education">Education</option>
            <option value="other">Other</option>
        </select>
    </div>

    <div class="form-group">
        <label for="status">Status</label>
        <select id="status">
            <option value="draft">Draft</option>
            <option value="published">Published</option>
        </select>
    </div>

    <div class="form-group">
        <label for="featured_image">Featured Image</label>
        <input type="file" id="featured_image" accept="image/*" onchange="previewImage(event)">
        <div class="image-preview" id="imagePreview">
            <img id="preview" src="" alt="Image preview">
        </div>
    </div>

    <button onclick="createBlog()">Create Blog Post</button>
</div>
{% endblock %}

{% block extra_js %}
<script>
function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('preview').src = e.target.result;
            document.getElementById('imagePreview').style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
}

function createBlog(){
    const formData = new FormData();
    formData.append('title', title.value);
    formData.append('content', content.value);
    formData.append('category', document.getElementById('category').value);
    formData.append('status', document.getElementById('status').value);

    
    
    const imageFile = document.getElementById('featured_image').files[0];
    if (imageFile) {
        formData.append('featured_image', imageFile);
    }

    fetch("/api/posts/", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: formData  
    })
    .then(async res => {
    const data = await res.json();
    if (!res.ok) {
        console.error(data);
        alert(JSON.stringify(data));
        throw new Error("API Error");
    }
    return data;
})
    .then(() => {
        alert('Blog post created successfully!');
        window.location.href = "/dashboard/";
    })
    .catch(err => {
        console.error('Error:', err);
        alert('Error creating blog post. Please try again.');
    });
}

</script>
{% endblock %}